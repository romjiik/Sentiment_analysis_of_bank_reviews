{"metadata":{"accelerator":"GPU","colab":{"provenance":[],"gpuType":"T4","authorship_tag":"ABX9TyNUB9Dc4TpWaVH9xU+jFwZ4","include_colab_link":true},"gpuClass":"standard","kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"language_info":{"name":"python","version":"3.10.10","mimetype":"text/x-python","codemirror_mode":{"name":"ipython","version":3},"pygments_lexer":"ipython3","nbconvert_exporter":"python","file_extension":".py"},"widgets":{"application/vnd.jupyter.widget-state+json":{"4ee2d8ab0b144552b20f8939195fa0bb":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_75b07fe9d7454d55b6356599736b5869","IPY_MODEL_30a5190e12414f17bea7efa46d45afd4","IPY_MODEL_1bd431a4d44446fb8589a69ce87c2b17"],"layout":"IPY_MODEL_7dce9d76acce449e9b2ddd3224b4fa6b"}},"75b07fe9d7454d55b6356599736b5869":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_69a4af58232e4596a7e782a6a7038771","placeholder":"​","style":"IPY_MODEL_df21d39a78dd4247b77b8c6f6bd8cc1b","value":"100%"}},"30a5190e12414f17bea7efa46d45afd4":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_a35c40a847244753a5a6de6c6e4fe6e8","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_29b47a6d54fd43e0bb020b0fa00fa26d","value":1}},"1bd431a4d44446fb8589a69ce87c2b17":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_4c773d81362744e1b7a358a6a10aa85c","placeholder":"​","style":"IPY_MODEL_11e67af6bca247e1804947669a24a3a4","value":" 1/1 [01:30&lt;00:00, 90.40s/it]"}},"7dce9d76acce449e9b2ddd3224b4fa6b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"69a4af58232e4596a7e782a6a7038771":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"df21d39a78dd4247b77b8c6f6bd8cc1b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a35c40a847244753a5a6de6c6e4fe6e8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"29b47a6d54fd43e0bb020b0fa00fa26d":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"4c773d81362744e1b7a358a6a10aa85c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"11e67af6bca247e1804947669a24a3a4":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"3b6e448523654430b56af8f12fe5a325":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_ee9b8f9684c14ec18ea917de9df29ae5","IPY_MODEL_f1d77621eb854f5e9b95a0fb2b2eb76b","IPY_MODEL_607dab97b70945319576f4a9b4a5035e"],"layout":"IPY_MODEL_9183ef29621a4c77b1e6c320213f464e"}},"ee9b8f9684c14ec18ea917de9df29ae5":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_9c698c4b197748f1996ed8508bd77e08","placeholder":"​","style":"IPY_MODEL_14bb72b8a3f941e38704136d6b91783c","value":"100%"}},"f1d77621eb854f5e9b95a0fb2b2eb76b":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_338b387e7542479c8fc069c416767c7e","max":432,"min":0,"orientation":"horizontal","style":"IPY_MODEL_ff7501d9df514707aefaa65ebd6302b7","value":432}},"607dab97b70945319576f4a9b4a5035e":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_cc1d833d115744eaa7077c1685179d46","placeholder":"​","style":"IPY_MODEL_1262f734447d43ce85ac1405b5426440","value":" 432/432 [01:20&lt;00:00,  5.26it/s]"}},"9183ef29621a4c77b1e6c320213f464e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c698c4b197748f1996ed8508bd77e08":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"14bb72b8a3f941e38704136d6b91783c":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"338b387e7542479c8fc069c416767c7e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ff7501d9df514707aefaa65ebd6302b7":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"cc1d833d115744eaa7077c1685179d46":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"1262f734447d43ce85ac1405b5426440":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a03555727b794a84adb3a5b07704dfb8":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_a2dc8e47b8f54a39b963945a2bf834f7","IPY_MODEL_ccdab01e699d45c1bd6810228e94949a","IPY_MODEL_c32e7dd119184efbb805234fabddff7d"],"layout":"IPY_MODEL_bfcab00ef22347518b62072da8c8006a"}},"a2dc8e47b8f54a39b963945a2bf834f7":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_0bade0a671214a9ea4a0a1daa6061e4b","placeholder":"​","style":"IPY_MODEL_165040e0d4364b6caf2f7af0c3a3683b","value":"100%"}},"ccdab01e699d45c1bd6810228e94949a":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_cb0160c6801440a4bfa3e607bd02845b","max":108,"min":0,"orientation":"horizontal","style":"IPY_MODEL_26ffb3b56e474d818ef8f38706f0120b","value":108}},"c32e7dd119184efbb805234fabddff7d":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e707799ef6324ad1bf04f07a84b5c7fb","placeholder":"​","style":"IPY_MODEL_9d038fd98ad542e681b5267c0427f90e","value":" 108/108 [00:09&lt;00:00, 11.09it/s]"}},"bfcab00ef22347518b62072da8c8006a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0bade0a671214a9ea4a0a1daa6061e4b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"165040e0d4364b6caf2f7af0c3a3683b":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"cb0160c6801440a4bfa3e607bd02845b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"26ffb3b56e474d818ef8f38706f0120b":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"e707799ef6324ad1bf04f07a84b5c7fb":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9d038fd98ad542e681b5267c0427f90e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"200d0a99a0144778a1cc5b258e1664d6":{"model_module":"@jupyter-widgets/controls","model_name":"VBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"VBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"VBoxView","box_style":"","children":["IPY_MODEL_f5ebc71ea724426aa5c72922fafddd45","IPY_MODEL_3477a24a347e4e6fbbd5f3d0c8dc8665"],"layout":"IPY_MODEL_46dcb6167d674379949960af017f33ed"}},"f5ebc71ea724426aa5c72922fafddd45":{"model_module":"@jupyter-widgets/controls","model_name":"LabelModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"LabelModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"LabelView","description":"","description_tooltip":null,"layout":"IPY_MODEL_de4f60c359b948ddb55a0821d2a56d17","placeholder":"​","style":"IPY_MODEL_36a671c29393418481477982913588c8","value":"0.002 MB of 0.003 MB uploaded (0.000 MB deduped)\r"}},"3477a24a347e4e6fbbd5f3d0c8dc8665":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"","description":"","description_tooltip":null,"layout":"IPY_MODEL_ecef023b6ab441c4aeeaee168973af3f","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_2754924fcff143da954bf12e279bf71a","value":0.9037472446730346}},"46dcb6167d674379949960af017f33ed":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"de4f60c359b948ddb55a0821d2a56d17":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"36a671c29393418481477982913588c8":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ecef023b6ab441c4aeeaee168973af3f":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"2754924fcff143da954bf12e279bf71a":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}}}}},"nbformat_minor":4,"nbformat":4,"cells":[{"cell_type":"markdown","source":"<a href=\"https://colab.research.google.com/github/romjiik/Course_work/blob/main/BERT.ipynb\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>","metadata":{"id":"view-in-github","colab_type":"text"}},{"cell_type":"markdown","source":" # BEST BERT","metadata":{"id":"ZPaG_iFu8KFh"}},{"cell_type":"code","source":"from google.colab import drive\ndrive.mount('/content/drive')","metadata":{"id":"gIsAGrVh_HmF","colab":{"base_uri":"https://localhost:8080/"},"outputId":"4e380026-1ed9-4414-cfd9-fbb5a6a06d38"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":"Mounted at /content/drive\n"}]},{"cell_type":"code","source":"!pip3 install transformers","metadata":{"id":"QVJqFiIx_TUF","colab":{"base_uri":"https://localhost:8080/"},"outputId":"a5b019db-05a7-4880-bbab-3c42620d2c08","execution":{"iopub.status.busy":"2023-06-25T10:16:25.103669Z","iopub.execute_input":"2023-06-25T10:16:25.104162Z","iopub.status.idle":"2023-06-25T10:16:39.139626Z","shell.execute_reply.started":"2023-06-25T10:16:25.104136Z","shell.execute_reply":"2023-06-25T10:16:39.138345Z"},"trusted":true},"execution_count":1,"outputs":[{"name":"stdout","text":"Requirement already satisfied: transformers in /opt/conda/lib/python3.10/site-packages (4.30.1)\nRequirement already satisfied: filelock in /opt/conda/lib/python3.10/site-packages (from transformers) (3.12.0)\nRequirement already satisfied: huggingface-hub<1.0,>=0.14.1 in /opt/conda/lib/python3.10/site-packages (from transformers) (0.15.1)\nRequirement already satisfied: numpy>=1.17 in /opt/conda/lib/python3.10/site-packages (from transformers) (1.23.5)\nRequirement already satisfied: packaging>=20.0 in /opt/conda/lib/python3.10/site-packages (from transformers) (21.3)\nRequirement already satisfied: pyyaml>=5.1 in /opt/conda/lib/python3.10/site-packages (from transformers) (5.4.1)\nRequirement already satisfied: regex!=2019.12.17 in /opt/conda/lib/python3.10/site-packages (from transformers) (2023.5.5)\nRequirement already satisfied: requests in /opt/conda/lib/python3.10/site-packages (from transformers) (2.28.2)\nRequirement already satisfied: tokenizers!=0.11.3,<0.14,>=0.11.1 in /opt/conda/lib/python3.10/site-packages (from transformers) (0.13.3)\nRequirement already satisfied: safetensors>=0.3.1 in /opt/conda/lib/python3.10/site-packages (from transformers) (0.3.1)\nRequirement already satisfied: tqdm>=4.27 in /opt/conda/lib/python3.10/site-packages (from transformers) (4.64.1)\nRequirement already satisfied: fsspec in /opt/conda/lib/python3.10/site-packages (from huggingface-hub<1.0,>=0.14.1->transformers) (2023.6.0)\nRequirement already satisfied: typing-extensions>=3.7.4.3 in /opt/conda/lib/python3.10/site-packages (from huggingface-hub<1.0,>=0.14.1->transformers) (4.5.0)\nRequirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /opt/conda/lib/python3.10/site-packages (from packaging>=20.0->transformers) (3.0.9)\nRequirement already satisfied: charset-normalizer<4,>=2 in /opt/conda/lib/python3.10/site-packages (from requests->transformers) (2.1.1)\nRequirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.10/site-packages (from requests->transformers) (3.4)\nRequirement already satisfied: urllib3<1.27,>=1.21.1 in /opt/conda/lib/python3.10/site-packages (from requests->transformers) (1.26.15)\nRequirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.10/site-packages (from requests->transformers) (2023.5.7)\n\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\u001b[0m\u001b[33m\n\u001b[0m","output_type":"stream"}]},{"cell_type":"code","source":"!pip install wandb -qU","metadata":{"id":"90w9cS9WdCXB","colab":{"base_uri":"https://localhost:8080/"},"outputId":"3845750a-35e4-4fb1-f0b6-6c5c569b4e6d","execution":{"iopub.status.busy":"2023-06-25T10:16:39.142244Z","iopub.execute_input":"2023-06-25T10:16:39.142622Z","iopub.status.idle":"2023-06-25T10:16:50.695679Z","shell.execute_reply.started":"2023-06-25T10:16:39.142584Z","shell.execute_reply":"2023-06-25T10:16:50.694512Z"},"trusted":true},"execution_count":2,"outputs":[{"name":"stdout","text":"\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\u001b[0m\u001b[33m\n\u001b[0m","output_type":"stream"}]},{"cell_type":"code","source":"!pip install torcheval","metadata":{"id":"aBlJOsohQZrQ","colab":{"base_uri":"https://localhost:8080/"},"outputId":"2787fafe-af2b-4c2f-b0b0-553348d74093","execution":{"iopub.status.busy":"2023-06-25T10:16:50.698149Z","iopub.execute_input":"2023-06-25T10:16:50.698543Z","iopub.status.idle":"2023-06-25T10:17:02.354282Z","shell.execute_reply.started":"2023-06-25T10:16:50.698503Z","shell.execute_reply":"2023-06-25T10:17:02.353091Z"},"trusted":true},"execution_count":3,"outputs":[{"name":"stdout","text":"Collecting torcheval\n  Downloading torcheval-0.0.6-py3-none-any.whl (158 kB)\n\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m158.4/158.4 kB\u001b[0m \u001b[31m4.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n\u001b[?25hCollecting torchtnt>=0.0.5 (from torcheval)\n  Downloading torchtnt-0.1.0-py3-none-any.whl (87 kB)\n\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m87.9/87.9 kB\u001b[0m \u001b[31m8.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n\u001b[?25hRequirement already satisfied: typing-extensions in /opt/conda/lib/python3.10/site-packages (from torcheval) (4.5.0)\nRequirement already satisfied: torch in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (2.0.0)\nRequirement already satisfied: numpy in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (1.23.5)\nRequirement already satisfied: fsspec in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (2023.6.0)\nRequirement already satisfied: tensorboard in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (2.12.3)\nRequirement already satisfied: packaging in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (21.3)\nRequirement already satisfied: psutil in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (5.9.3)\nCollecting pyre-extensions (from torchtnt>=0.0.5->torcheval)\n  Downloading pyre_extensions-0.0.30-py3-none-any.whl (12 kB)\nRequirement already satisfied: setuptools in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (59.8.0)\nRequirement already satisfied: tqdm in /opt/conda/lib/python3.10/site-packages (from torchtnt>=0.0.5->torcheval) (4.64.1)\nRequirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /opt/conda/lib/python3.10/site-packages (from packaging->torchtnt>=0.0.5->torcheval) (3.0.9)\nRequirement already satisfied: typing-inspect in /opt/conda/lib/python3.10/site-packages (from pyre-extensions->torchtnt>=0.0.5->torcheval) (0.9.0)\nRequirement already satisfied: absl-py>=0.4 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (1.4.0)\nRequirement already satisfied: grpcio>=1.48.2 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (1.51.1)\nRequirement already satisfied: google-auth<3,>=1.6.3 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (2.17.3)\nRequirement already satisfied: google-auth-oauthlib<1.1,>=0.5 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (1.0.0)\nRequirement already satisfied: markdown>=2.6.8 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (3.4.3)\nRequirement already satisfied: protobuf>=3.19.6 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (3.20.3)\nRequirement already satisfied: requests<3,>=2.21.0 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (2.28.2)\nRequirement already satisfied: tensorboard-data-server<0.8.0,>=0.7.0 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (0.7.0)\nRequirement already satisfied: werkzeug>=1.0.1 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (2.3.6)\nRequirement already satisfied: wheel>=0.26 in /opt/conda/lib/python3.10/site-packages (from tensorboard->torchtnt>=0.0.5->torcheval) (0.40.0)\nRequirement already satisfied: filelock in /opt/conda/lib/python3.10/site-packages (from torch->torchtnt>=0.0.5->torcheval) (3.12.0)\nRequirement already satisfied: sympy in /opt/conda/lib/python3.10/site-packages (from torch->torchtnt>=0.0.5->torcheval) (1.12)\nRequirement already satisfied: networkx in /opt/conda/lib/python3.10/site-packages (from torch->torchtnt>=0.0.5->torcheval) (3.1)\nRequirement already satisfied: jinja2 in /opt/conda/lib/python3.10/site-packages (from torch->torchtnt>=0.0.5->torcheval) (3.1.2)\nRequirement already satisfied: cachetools<6.0,>=2.0.0 in /opt/conda/lib/python3.10/site-packages (from google-auth<3,>=1.6.3->tensorboard->torchtnt>=0.0.5->torcheval) (4.2.4)\nRequirement already satisfied: pyasn1-modules>=0.2.1 in /opt/conda/lib/python3.10/site-packages (from google-auth<3,>=1.6.3->tensorboard->torchtnt>=0.0.5->torcheval) (0.2.7)\nRequirement already satisfied: six>=1.9.0 in /opt/conda/lib/python3.10/site-packages (from google-auth<3,>=1.6.3->tensorboard->torchtnt>=0.0.5->torcheval) (1.16.0)\nRequirement already satisfied: rsa<5,>=3.1.4 in /opt/conda/lib/python3.10/site-packages (from google-auth<3,>=1.6.3->tensorboard->torchtnt>=0.0.5->torcheval) (4.9)\nRequirement already satisfied: requests-oauthlib>=0.7.0 in /opt/conda/lib/python3.10/site-packages (from google-auth-oauthlib<1.1,>=0.5->tensorboard->torchtnt>=0.0.5->torcheval) (1.3.1)\nRequirement already satisfied: charset-normalizer<4,>=2 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.21.0->tensorboard->torchtnt>=0.0.5->torcheval) (2.1.1)\nRequirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.21.0->tensorboard->torchtnt>=0.0.5->torcheval) (3.4)\nRequirement already satisfied: urllib3<1.27,>=1.21.1 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.21.0->tensorboard->torchtnt>=0.0.5->torcheval) (1.26.15)\nRequirement already satisfied: certifi>=2017.4.17 in /opt/conda/lib/python3.10/site-packages (from requests<3,>=2.21.0->tensorboard->torchtnt>=0.0.5->torcheval) (2023.5.7)\nRequirement already satisfied: MarkupSafe>=2.1.1 in /opt/conda/lib/python3.10/site-packages (from werkzeug>=1.0.1->tensorboard->torchtnt>=0.0.5->torcheval) (2.1.2)\nRequirement already satisfied: mpmath>=0.19 in /opt/conda/lib/python3.10/site-packages (from sympy->torch->torchtnt>=0.0.5->torcheval) (1.3.0)\nRequirement already satisfied: mypy-extensions>=0.3.0 in /opt/conda/lib/python3.10/site-packages (from typing-inspect->pyre-extensions->torchtnt>=0.0.5->torcheval) (1.0.0)\nRequirement already satisfied: pyasn1<0.5.0,>=0.4.6 in /opt/conda/lib/python3.10/site-packages (from pyasn1-modules>=0.2.1->google-auth<3,>=1.6.3->tensorboard->torchtnt>=0.0.5->torcheval) (0.4.8)\nRequirement already satisfied: oauthlib>=3.0.0 in /opt/conda/lib/python3.10/site-packages (from requests-oauthlib>=0.7.0->google-auth-oauthlib<1.1,>=0.5->tensorboard->torchtnt>=0.0.5->torcheval) (3.2.2)\nInstalling collected packages: pyre-extensions, torchtnt, torcheval\nSuccessfully installed pyre-extensions-0.0.30 torcheval-0.0.6 torchtnt-0.1.0\n\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\u001b[0m\u001b[33m\n\u001b[0m","output_type":"stream"}]},{"cell_type":"code","source":"import numpy as np\nimport pandas as pd\nfrom sklearn.metrics import f1_score\nfrom sklearn.model_selection import train_test_split\nimport torch\nfrom torch import nn, optim\nimport matplotlib.pyplot as plt\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=DeprecationWarning)","metadata":{"id":"loUCGVQLG60q","execution":{"iopub.status.busy":"2023-06-25T10:17:06.200043Z","iopub.execute_input":"2023-06-25T10:17:06.200639Z","iopub.status.idle":"2023-06-25T10:17:10.602344Z","shell.execute_reply.started":"2023-06-25T10:17:06.200603Z","shell.execute_reply":"2023-06-25T10:17:10.601296Z"},"trusted":true},"execution_count":4,"outputs":[]},{"cell_type":"code","source":"def seed_everything(seed: int):\n    import random, os\n    import numpy as np\n    import torch\n\n    random.seed(seed)\n    os.environ['PYTHONHASHSEED'] = str(seed)\n    np.random.seed(seed)\n    torch.manual_seed(seed)\n    torch.cuda.manual_seed(seed)\n    torch.backends.cudnn.benchmark = True","metadata":{"id":"xnSagAbq7_3G","execution":{"iopub.status.busy":"2023-06-25T10:17:10.607551Z","iopub.execute_input":"2023-06-25T10:17:10.610248Z","iopub.status.idle":"2023-06-25T10:17:10.622407Z","shell.execute_reply.started":"2023-06-25T10:17:10.610169Z","shell.execute_reply":"2023-06-25T10:17:10.621278Z"},"trusted":true},"execution_count":5,"outputs":[]},{"cell_type":"code","source":"TEST_SIZE = 0.2 # Test size for metric check\nTIMEOUT = 9000 # Time in seconds for automl run\nTARGET_NAME = 'rating_value' # Target column name","metadata":{"id":"3vOHgPmTHalh","execution":{"iopub.status.busy":"2023-06-25T10:17:10.624210Z","iopub.execute_input":"2023-06-25T10:17:10.625052Z","iopub.status.idle":"2023-06-25T10:17:10.632994Z","shell.execute_reply.started":"2023-06-25T10:17:10.624944Z","shell.execute_reply":"2023-06-25T10:17:10.632025Z"},"trusted":true},"execution_count":6,"outputs":[]},{"cell_type":"code","source":"df = pd.read_csv('/kaggle/input/bank-reviews-dataset/final_review_dataset_extended.csv')\ndf['rating_value'] = df['rating_value'] - 1","metadata":{"id":"-auZyQ1m9_d3","execution":{"iopub.status.busy":"2023-06-25T10:17:10.635816Z","iopub.execute_input":"2023-06-25T10:17:10.636491Z","iopub.status.idle":"2023-06-25T10:17:11.306077Z","shell.execute_reply.started":"2023-06-25T10:17:10.636460Z","shell.execute_reply":"2023-06-25T10:17:11.305079Z"},"trusted":true},"execution_count":7,"outputs":[]},{"cell_type":"code","source":"train_data, test_data = train_test_split(df,\n                                         test_size=TEST_SIZE,\n                                         stratify=df[TARGET_NAME],\n                                         random_state=10)\n\nprint('Data splitted. Parts sizes: train_data = {}, test_data = {}'\n              .format(train_data.shape, test_data.shape))","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ZwXfo_VpHhBj","outputId":"31d2cd4c-1ddb-4454-b784-e8ebc291b3e5","execution":{"iopub.status.busy":"2023-06-25T10:17:11.307525Z","iopub.execute_input":"2023-06-25T10:17:11.307879Z","iopub.status.idle":"2023-06-25T10:17:11.328197Z","shell.execute_reply.started":"2023-06-25T10:17:11.307846Z","shell.execute_reply":"2023-06-25T10:17:11.327226Z"},"trusted":true},"execution_count":8,"outputs":[{"name":"stdout","text":"Data splitted. Parts sizes: train_data = (9913, 16), test_data = (2479, 16)\n","output_type":"stream"}]},{"cell_type":"code","source":"train, valid = train_test_split(train_data,\n                                         test_size=TEST_SIZE,\n                                         stratify=train_data[TARGET_NAME],\n                                         random_state=10)\n\nprint('Data splitted. Parts sizes: train = {}, valid = {}'\n              .format(train.shape, valid.shape))","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"wAtaGzg3HmQY","outputId":"a20b5e02-7f67-4b5c-841d-00d2f8b13355","execution":{"iopub.status.busy":"2023-06-25T10:17:11.329451Z","iopub.execute_input":"2023-06-25T10:17:11.331572Z","iopub.status.idle":"2023-06-25T10:17:11.346388Z","shell.execute_reply.started":"2023-06-25T10:17:11.331536Z","shell.execute_reply":"2023-06-25T10:17:11.345432Z"},"trusted":true},"execution_count":9,"outputs":[{"name":"stdout","text":"Data splitted. Parts sizes: train = (7930, 16), valid = (1983, 16)\n","output_type":"stream"}]},{"cell_type":"code","source":"import wandb\nwandb.login()","metadata":{"id":"2HEcUFBMdEay","colab":{"base_uri":"https://localhost:8080/","height":72},"outputId":"bc033728-3e3c-4eb3-cce1-5818b8c49e7d","execution":{"iopub.status.busy":"2023-06-25T10:17:12.092755Z","iopub.execute_input":"2023-06-25T10:17:12.094043Z","iopub.status.idle":"2023-06-25T10:17:24.930541Z","shell.execute_reply.started":"2023-06-25T10:17:12.094003Z","shell.execute_reply":"2023-06-25T10:17:24.929586Z"},"trusted":true},"execution_count":10,"outputs":[{"name":"stderr","text":"\u001b[34m\u001b[1mwandb\u001b[0m: Logging into wandb.ai. (Learn how to deploy a W&B server locally: https://wandb.me/wandb-server)\n\u001b[34m\u001b[1mwandb\u001b[0m: You can find your API key in your browser here: https://wandb.ai/authorize\n\u001b[34m\u001b[1mwandb\u001b[0m: Paste an API key from your profile and hit enter, or press ctrl+c to quit:","output_type":"stream"},{"output_type":"stream","name":"stdin","text":"  ········································\n"},{"name":"stderr","text":"\u001b[34m\u001b[1mwandb\u001b[0m: Appending key for api.wandb.ai to your netrc file: /root/.netrc\n","output_type":"stream"},{"execution_count":10,"output_type":"execute_result","data":{"text/plain":"True"},"metadata":{}}]},{"cell_type":"code","source":"config={\n      \"learning_rate\": 2e-5,\n      \"architecture\": \"cointegrated/LaBSE-en-ru\",\n      \"weight_balance\": False,\n      \"dataset\": \"Bank_review_dataset\",\n      \"epochs\": 3,\n      \"batch_size\": 16,\n}\n\nwandb.init(\n    # Set the project where this run will be logged\n    project=\"course_work\",\n    # We pass a run name (otherwise it’ll be randomly assigned, like sunshine-lollypop-10)\n    name=f\"LaBSE_bert BEST\",\n    # Track hyperparameters and run metadata\n    config=config)","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":125},"id":"fuy9pW-ioYg5","outputId":"e4bd720a-7a7d-4a7c-a934-0336fc0facbd","execution":{"iopub.status.busy":"2023-06-25T10:18:28.868589Z","iopub.execute_input":"2023-06-25T10:18:28.869234Z","iopub.status.idle":"2023-06-25T10:18:59.779743Z","shell.execute_reply.started":"2023-06-25T10:18:28.869203Z","shell.execute_reply":"2023-06-25T10:18:59.778952Z"},"trusted":true},"execution_count":11,"outputs":[{"name":"stderr","text":"\u001b[34m\u001b[1mwandb\u001b[0m: Currently logged in as: \u001b[33mberdyshevrv\u001b[0m (\u001b[33mromjiik\u001b[0m). Use \u001b[1m`wandb login --relogin`\u001b[0m to force relogin\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Tracking run with wandb version 0.15.4"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Run data is saved locally in <code>/kaggle/working/wandb/run-20230625_101828-6kx5wlkl</code>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Syncing run <strong><a href='https://wandb.ai/romjiik/course_work/runs/6kx5wlkl' target=\"_blank\">LaBSE_bert BEST</a></strong> to <a href='https://wandb.ai/romjiik/course_work' target=\"_blank\">Weights & Biases</a> (<a href='https://wandb.me/run' target=\"_blank\">docs</a>)<br/>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":" View project at <a href='https://wandb.ai/romjiik/course_work' target=\"_blank\">https://wandb.ai/romjiik/course_work</a>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":" View run at <a href='https://wandb.ai/romjiik/course_work/runs/6kx5wlkl' target=\"_blank\">https://wandb.ai/romjiik/course_work/runs/6kx5wlkl</a>"},"metadata":{}},{"execution_count":11,"output_type":"execute_result","data":{"text/html":"<button onClick=\"this.nextSibling.style.display='block';this.style.display='none';\">Display W&B run</button><iframe src='https://wandb.ai/romjiik/course_work/runs/6kx5wlkl?jupyter=true' style='border:none;width:100%;height:420px;display:none;'></iframe>","text/plain":"<wandb.sdk.wandb_run.Run at 0x7d50ab822860>"},"metadata":{}}]},{"cell_type":"code","source":"import torch\nfrom torch.utils.data import Dataset\n\nclass CustomDataset(Dataset):\n\n    def __init__(self, texts, targets, tokenizer, max_len=512):\n        self.texts = texts\n        self.targets = targets\n        self.tokenizer = tokenizer\n        self.max_len = max_len\n\n    def __len__(self):\n        return len(self.texts)\n\n    def __getitem__(self, idx):\n        text = str(self.texts[idx])\n        target = self.targets[idx]\n\n        encoding = self.tokenizer.encode_plus(\n            text,\n            add_special_tokens=True,\n            max_length=self.max_len,\n            return_token_type_ids=False,\n            padding='max_length',\n            return_attention_mask=True,\n            return_tensors='pt',\n            truncation=True\n        )\n\n        return {\n          'text': text,\n          'input_ids': encoding['input_ids'].flatten(),\n          'attention_mask': encoding['attention_mask'].flatten(),\n          'targets': torch.tensor(target, dtype=torch.long)\n        }","metadata":{"id":"0Pq8C86Bbt6B","execution":{"iopub.status.busy":"2023-06-25T10:18:59.784170Z","iopub.execute_input":"2023-06-25T10:18:59.786267Z","iopub.status.idle":"2023-06-25T10:18:59.798194Z","shell.execute_reply.started":"2023-06-25T10:18:59.786233Z","shell.execute_reply":"2023-06-25T10:18:59.797297Z"},"trusted":true},"execution_count":12,"outputs":[]},{"cell_type":"code","source":"import numpy as np\nimport torch\nfrom torcheval.metrics.functional import multiclass_f1_score\nfrom transformers import BertTokenizer, BertForSequenceClassification\nfrom torch.utils.data import Dataset, DataLoader\nfrom transformers import AdamW, get_linear_schedule_with_warmup\nfrom tqdm.notebook import tqdm\nimport wandb\n\n\nclass BertClassifier(nn.Module):\n\n    def __init__(self, model_path, tokenizer_path, n_classes=5, epochs=1, model_save_path='/content/bert.pt'):\n        super(BertClassifier, self).__init__()\n        self.model = BertForSequenceClassification.from_pretrained(model_path)\n        self.tokenizer = BertTokenizer.from_pretrained(tokenizer_path)\n        self.device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n        self.model_save_path=model_save_path\n        self.max_len = 512\n        self.epochs = epochs\n        self.out_features = self.model.bert.encoder.layer[1].output.dense.out_features\n        self.model.classifier = torch.nn.Linear(self.out_features, n_classes)\n        self.model.to(self.device)\n\n    def preparation(self, X_train, y_train, X_valid, y_valid):\n        data = pd.concat([pd.Series(X_train), pd.Series(y_train)], axis=1, ignore_index=True).rename(columns={0: 'review', 1: 'rating_value'})\n        # create datasets\n        self.train_set = CustomDataset(X_train, y_train, self.tokenizer)\n        self.valid_set = CustomDataset(X_valid, y_valid, self.tokenizer)\n\n        # create data loaders\n        self.train_loader = DataLoader(self.train_set, batch_size=16, shuffle=True)\n        self.valid_loader = DataLoader(self.valid_set, batch_size=16, shuffle=True)\n\n        # helpers initialization\n        self.optimizer = AdamW(self.model.parameters(), lr=2e-5, correct_bias=False)\n        self.scheduler = get_linear_schedule_with_warmup(\n                self.optimizer,\n                num_warmup_steps=0,\n                num_training_steps=len(self.train_loader) * self.epochs\n            )\n        # с учетом дисбаланса классов\n#         weights = torch.tensor(list(data.groupby('rating_value').count().review.max() / data.groupby('rating_value').count().review))\n#         self.loss_fn = torch.nn.CrossEntropyLoss(weight=weights).to(self.device)\n        # без учета дисбаланса классов\n        self.loss_fn = torch.nn.CrossEntropyLoss().to(self.device)\n\n    def fit(self):\n        self.model = self.model.train()\n        losses = []\n        f1_micro_scores = []\n        f1_macro_scores = []\n        accuracy_scores = []\n        correct_predictions = 0\n\n        for step, data in enumerate(tqdm(self.train_loader)):\n            input_ids = data[\"input_ids\"].to(self.device)\n            attention_mask = data[\"attention_mask\"].to(self.device)\n            targets = data[\"targets\"].to(self.device)\n\n            outputs = self.model(\n                input_ids=input_ids,\n                attention_mask=attention_mask\n                )\n            preds = torch.argmax(outputs.logits, dim=1)\n\n            loss = self.loss_fn(outputs.logits, targets)\n\n            correct_predictions += torch.sum(preds == targets)\n            acc = torch.sum(preds == targets) / len(targets)\n            f1_micro = multiclass_f1_score(preds, targets, num_classes=5, average='micro')\n            f1_macro = multiclass_f1_score(preds, targets, num_classes=5, average='macro')\n\n            losses.append(loss.item())\n            f1_micro_scores.append(f1_micro)\n            f1_macro_scores.append(f1_macro)\n            accuracy_scores.append(acc)\n\n            if step % 10 == 0:\n              wandb.log({\n                  'loss': torch.mean(torch.tensor(losses[-10:], dtype=torch.float32)),\n                  'accuracy': torch.mean(torch.tensor(accuracy_scores[-10:], dtype=torch.float32)),\n                  'f1_micro': torch.mean(torch.tensor(f1_micro_scores[-10:], dtype=torch.float32)),\n                  'f1_macro': torch.mean(torch.tensor(f1_macro_scores[-10:], dtype=torch.float32))\n                  })\n\n            loss.backward()\n            torch.nn.utils.clip_grad_norm_(self.model.parameters(), max_norm=1.0)\n            self.optimizer.step()\n            self.scheduler.step()\n            self.optimizer.zero_grad()\n\n\n        train_acc = correct_predictions.double() / len(self.train_set)\n        train_loss = torch.mean(torch.tensor(losses, dtype=torch.float32))\n        return train_acc, train_loss\n\n    def eval(self):\n        self.model = self.model.eval()\n        losses = []\n        correct_predictions = 0\n\n        with torch.no_grad():\n            for data in tqdm(self.valid_loader):\n                input_ids = data[\"input_ids\"].to(self.device)\n                attention_mask = data[\"attention_mask\"].to(self.device)\n                targets = data[\"targets\"].to(self.device)\n\n                outputs = self.model(\n                    input_ids=input_ids,\n                    attention_mask=attention_mask\n                    )\n\n                preds = torch.argmax(outputs.logits, dim=1)\n                loss = self.loss_fn(outputs.logits, targets)\n                correct_predictions += torch.sum(preds == targets)\n                losses.append(loss.item())\n\n        val_acc = correct_predictions.double() / len(self.valid_set)\n        val_loss = np.mean(losses)\n        return val_acc, val_loss\n\n    def train(self):\n        best_accuracy = 0\n        for epoch in tqdm(range(self.epochs)):\n            print(f'Epoch {epoch + 1}/{self.epochs}')\n            train_acc, train_loss = self.fit()\n            wandb.log({'train_acc': train_acc})\n            print(f'Train loss {train_loss} accuracy {train_acc}')\n\n            val_acc, val_loss = self.eval()\n            wandb.log({'val_acc': val_acc})\n            print(f'Val loss {val_loss} accuracy {val_acc}')\n            print('-' * 10)\n\n            if val_acc > best_accuracy:\n                torch.save({\n                    'epoch': epoch,\n                    'model_state_dict': self.model.state_dict(),\n                    'optimizer_state_dict': self.optimizer.state_dict(),\n                    'loss': val_loss,\n                    'accuracy': val_acc,\n                    }, self.model_save_path)\n                best_accuracy = val_acc\n\n        state = torch.load(self.model_save_path)\n        # self.model = BertClassifier(self.model_path, self.tokenizer_path)\n        self.model.load_state_dict(state['model_state_dict'])\n        data = pd.DataFrame(config, index=[0])\n        data['accuracy'], data['loss'] =  state['accuracy'], state['loss'] #self.model['accuracy'], self.model['loss']\n        table = wandb.Table(data=data)\n        wandb.log({'config': table})\n\n\n        wandb.finish()\n\n    def predict(self, text):\n        encoding = self.tokenizer.encode_plus(\n            text,\n            add_special_tokens=True,\n            max_length=self.max_len,\n            return_token_type_ids=False,\n            truncation=True,\n            padding='max_length',\n            return_attention_mask=True,\n            return_tensors='pt',\n        )\n\n        out = {\n              'text': text,\n              'input_ids': encoding['input_ids'].flatten(),\n              'attention_mask': encoding['attention_mask'].flatten()\n          }\n\n        input_ids = out[\"input_ids\"].to(self.device)\n        attention_mask = out[\"attention_mask\"].to(self.device)\n\n        outputs = self.model(\n            input_ids=input_ids.unsqueeze(0),\n            attention_mask=attention_mask.unsqueeze(0)\n        )\n        prediction = outputs.logits.cpu().detach()\n\n        return prediction\n","metadata":{"id":"n7aTJeGcbzKd","execution":{"iopub.status.busy":"2023-06-25T10:19:13.252559Z","iopub.execute_input":"2023-06-25T10:19:13.255277Z","iopub.status.idle":"2023-06-25T10:19:13.358082Z","shell.execute_reply.started":"2023-06-25T10:19:13.255241Z","shell.execute_reply":"2023-06-25T10:19:13.356404Z"},"trusted":true},"execution_count":14,"outputs":[]},{"cell_type":"code","source":"# cointegrated/LaBSE-en-ru\n# cointegrated/rubert-tiny-sentiment-balanced\n# DeepPavlov/rubert-base-cased-conversational\n\n\nseed_everything(42)\n\nclassifier = BertClassifier(\n        model_path='cointegrated/LaBSE-en-ru',\n        tokenizer_path='cointegrated/LaBSE-en-ru',\n        n_classes=5,\n        epochs=3,\n        model_save_path='/kaggle/working/LaBSE_bert_best.pt'\n)","metadata":{"id":"mW7oNmnuHnrM","execution":{"iopub.status.busy":"2023-06-25T10:19:13.359405Z","iopub.execute_input":"2023-06-25T10:19:13.359892Z","iopub.status.idle":"2023-06-25T10:19:29.187981Z","shell.execute_reply.started":"2023-06-25T10:19:13.359828Z","shell.execute_reply":"2023-06-25T10:19:29.186983Z"},"trusted":true},"execution_count":15,"outputs":[{"output_type":"display_data","data":{"text/plain":"Downloading (…)lve/main/config.json:   0%|          | 0.00/806 [00:00<?, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"3854d691baac49b5b6e14fa99d758c90"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"Downloading model.safetensors:   0%|          | 0.00/516M [00:00<?, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"6f652789994e42eebc54dd64cf6ea240"}},"metadata":{}},{"name":"stderr","text":"Some weights of the model checkpoint at cointegrated/LaBSE-en-ru were not used when initializing BertForSequenceClassification: ['cls.predictions.bias', 'cls.predictions.transform.dense.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.transform.LayerNorm.weight', 'cls.seq_relationship.bias', 'cls.predictions.transform.LayerNorm.bias', 'cls.seq_relationship.weight']\n- This IS expected if you are initializing BertForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n- This IS NOT expected if you are initializing BertForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\nSome weights of BertForSequenceClassification were not initialized from the model checkpoint at cointegrated/LaBSE-en-ru and are newly initialized: ['classifier.weight', 'classifier.bias']\nYou should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"Downloading (…)solve/main/vocab.txt: 0.00B [00:00, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"b99f06b6c56a45ac833aa24b82fc8e58"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"Downloading (…)cial_tokens_map.json:   0%|          | 0.00/112 [00:00<?, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"f436482168be48508098130b8e951f2b"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"Downloading (…)okenizer_config.json:   0%|          | 0.00/49.0 [00:00<?, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"f590cb2cb30a48deb360e54db88d6516"}},"metadata":{}}]},{"cell_type":"code","source":"classifier.preparation(\n        X_train=list(train_data['review']),\n        y_train=list(train_data['rating_value']),\n        X_valid=list(test_data['review']),\n        y_valid=list(test_data['rating_value'])\n    )","metadata":{"id":"ap3jdiB3H0Wv","colab":{"base_uri":"https://localhost:8080/"},"outputId":"09b5e960-9406-48b5-8180-9e58f2f31f4c","execution":{"iopub.status.busy":"2023-06-25T10:19:29.190102Z","iopub.execute_input":"2023-06-25T10:19:29.190806Z","iopub.status.idle":"2023-06-25T10:19:29.224411Z","shell.execute_reply.started":"2023-06-25T10:19:29.190753Z","shell.execute_reply":"2023-06-25T10:19:29.223519Z"},"trusted":true},"execution_count":16,"outputs":[{"name":"stderr","text":"/opt/conda/lib/python3.10/site-packages/transformers/optimization.py:411: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning\n  warnings.warn(\n","output_type":"stream"}]},{"cell_type":"code","source":"%%time\nclassifier.train()","metadata":{"id":"mSF8mbDDH2Ob","colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["4ee2d8ab0b144552b20f8939195fa0bb","75b07fe9d7454d55b6356599736b5869","30a5190e12414f17bea7efa46d45afd4","1bd431a4d44446fb8589a69ce87c2b17","7dce9d76acce449e9b2ddd3224b4fa6b","69a4af58232e4596a7e782a6a7038771","df21d39a78dd4247b77b8c6f6bd8cc1b","a35c40a847244753a5a6de6c6e4fe6e8","29b47a6d54fd43e0bb020b0fa00fa26d","4c773d81362744e1b7a358a6a10aa85c","11e67af6bca247e1804947669a24a3a4","3b6e448523654430b56af8f12fe5a325","ee9b8f9684c14ec18ea917de9df29ae5","f1d77621eb854f5e9b95a0fb2b2eb76b","607dab97b70945319576f4a9b4a5035e","9183ef29621a4c77b1e6c320213f464e","9c698c4b197748f1996ed8508bd77e08","14bb72b8a3f941e38704136d6b91783c","338b387e7542479c8fc069c416767c7e","ff7501d9df514707aefaa65ebd6302b7","cc1d833d115744eaa7077c1685179d46","1262f734447d43ce85ac1405b5426440","a03555727b794a84adb3a5b07704dfb8","a2dc8e47b8f54a39b963945a2bf834f7","ccdab01e699d45c1bd6810228e94949a","c32e7dd119184efbb805234fabddff7d","bfcab00ef22347518b62072da8c8006a","0bade0a671214a9ea4a0a1daa6061e4b","165040e0d4364b6caf2f7af0c3a3683b","cb0160c6801440a4bfa3e607bd02845b","26ffb3b56e474d818ef8f38706f0120b","e707799ef6324ad1bf04f07a84b5c7fb","9d038fd98ad542e681b5267c0427f90e","200d0a99a0144778a1cc5b258e1664d6","f5ebc71ea724426aa5c72922fafddd45","3477a24a347e4e6fbbd5f3d0c8dc8665","46dcb6167d674379949960af017f33ed","de4f60c359b948ddb55a0821d2a56d17","36a671c29393418481477982913588c8","ecef023b6ab441c4aeeaee168973af3f","2754924fcff143da954bf12e279bf71a"]},"outputId":"c642a5f4-f6d1-43d5-8a00-9f2b7756841a","execution":{"iopub.status.busy":"2023-06-25T10:19:39.422325Z","iopub.execute_input":"2023-06-25T10:19:39.422679Z","iopub.status.idle":"2023-06-25T11:13:21.045771Z","shell.execute_reply.started":"2023-06-25T10:19:39.422651Z","shell.execute_reply":"2023-06-25T11:13:21.044833Z"},"trusted":true},"execution_count":17,"outputs":[{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/3 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"dc454d148e8144afb9e3e83f0a230e36"}},"metadata":{}},{"name":"stdout","text":"Epoch 1/3\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/620 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"f83b10ba32064092828fa9a07ac661e6"}},"metadata":{}},{"name":"stdout","text":"Train loss 0.5931561589241028 accuracy 0.8287097750428729\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/155 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"892550c7260e4992a871b3cfd378b12a"}},"metadata":{}},{"name":"stdout","text":"Val loss 0.5420628666397064 accuracy 0.8398547801532876\n----------\nEpoch 2/3\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/620 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"d3b9c45516064dafa6a049f0fa0c4557"}},"metadata":{}},{"name":"stdout","text":"Train loss 0.48029235005378723 accuracy 0.851104610107939\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/155 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"bf81722c88cc483e8b1d3ecd7d2911e6"}},"metadata":{}},{"name":"stdout","text":"Val loss 0.5468515420152295 accuracy 0.8317870108914884\n----------\nEpoch 3/3\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/620 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"85cc70e18f0f43deafc5eac7fcf9d8d9"}},"metadata":{}},{"name":"stdout","text":"Train loss 0.40774065256118774 accuracy 0.8711792595581559\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/155 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"cdd1dbd3aa4549229ad0fdd332a63603"}},"metadata":{}},{"name":"stdout","text":"Val loss 0.5782988348314839 accuracy 0.8217022993142395\n----------\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Waiting for W&B process to finish... <strong style=\"color:green\">(success).</strong>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"VBox(children=(Label(value='0.002 MB of 0.003 MB uploaded (0.000 MB deduped)\\r'), FloatProgress(value=0.910628…","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"165416b4b6594fae9543dd1be10d9aed"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"<style>\n    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}\n    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }\n    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }\n    </style>\n<div class=\"wandb-row\"><div class=\"wandb-col\"><h3>Run history:</h3><br/><table class=\"wandb\"><tr><td>accuracy</td><td>▁▃▅▆▄▄▅▅▅▆▆▆▅▆▅▆▅▆▆▅▇▅▆▆▅▆▅▇▆▇▇█▆█▇▅▆▇▆▆</td></tr><tr><td>f1_macro</td><td>▂▁▄▅▃▂▄▅▅▅▅▄▄▄▄▄▃▅▅▄▆▅▅▆▄▅▃▆▇█▇█▆█▆▃▅▇▆▅</td></tr><tr><td>f1_micro</td><td>▁▃▅▆▄▄▅▅▅▆▆▆▅▆▅▆▅▆▆▅▇▅▆▆▅▆▅▇▆▇▇█▆█▇▅▆▇▆▆</td></tr><tr><td>loss</td><td>█▇▄▄▄▅▄▄▅▄▃▄▄▃▄▃▄▄▃▄▂▄▃▂▃▃▄▂▂▂▂▁▂▂▂▃▂▂▂▂</td></tr><tr><td>train_acc</td><td>▁▅█</td></tr><tr><td>val_acc</td><td>█▅▁</td></tr></table><br/></div><div class=\"wandb-col\"><h3>Run summary:</h3><br/><table class=\"wandb\"><tr><td>accuracy</td><td>0.86875</td></tr><tr><td>f1_macro</td><td>0.59352</td></tr><tr><td>f1_micro</td><td>0.86875</td></tr><tr><td>loss</td><td>0.35973</td></tr><tr><td>train_acc</td><td>0.87118</td></tr><tr><td>val_acc</td><td>0.8217</td></tr></table><br/></div></div>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":" View run <strong style=\"color:#cdcd00\">LaBSE_bert BEST</strong> at: <a href='https://wandb.ai/romjiik/course_work/runs/6kx5wlkl' target=\"_blank\">https://wandb.ai/romjiik/course_work/runs/6kx5wlkl</a><br/>Synced 6 W&B file(s), 1 media file(s), 1 artifact file(s) and 0 other file(s)"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Find logs at: <code>./wandb/run-20230625_101828-6kx5wlkl/logs</code>"},"metadata":{}},{"name":"stdout","text":"CPU times: user 52min 59s, sys: 15 s, total: 53min 14s\nWall time: 53min 41s\n","output_type":"stream"}]},{"cell_type":"code","source":"texts = list(test_data['review'])\npredictions = [classifier.predict(t) for t in texts]","metadata":{"id":"tLQ_JJQeKw2P","execution":{"iopub.status.busy":"2023-06-25T11:13:21.047836Z","iopub.execute_input":"2023-06-25T11:13:21.048483Z","iopub.status.idle":"2023-06-25T11:14:58.789846Z","shell.execute_reply.started":"2023-06-25T11:13:21.048447Z","shell.execute_reply":"2023-06-25T11:14:58.788811Z"},"trusted":true},"execution_count":18,"outputs":[]},{"cell_type":"code","source":"labels_true = test_data['rating_value']\nlabels_pred = torch.argmax(nn.functional.softmax(torch.cat(predictions,dim=0), dim=1), dim=1)","metadata":{"id":"i_Grho5xNldv","execution":{"iopub.status.busy":"2023-06-25T11:14:58.791312Z","iopub.execute_input":"2023-06-25T11:14:58.792152Z","iopub.status.idle":"2023-06-25T11:14:58.808750Z","shell.execute_reply.started":"2023-06-25T11:14:58.792118Z","shell.execute_reply":"2023-06-25T11:14:58.807755Z"},"trusted":true},"execution_count":19,"outputs":[]},{"cell_type":"code","source":"from sklearn.metrics import precision_recall_fscore_support, accuracy_score\n\nprecision, recall, f1score = precision_recall_fscore_support(labels_true, labels_pred,average='micro')[:3]\n\nprint(f'MICRO AVERAGE: precision: {precision}, recall: {recall}, f1score: {f1score}')\n\nprecision, recall, f1score = precision_recall_fscore_support(labels_true, labels_pred,average='macro')[:3]\n\nprint(f'MACRO AVERAGE: precision: {precision}, recall: {recall}, f1score: {f1score}')\n","metadata":{"id":"veVDn1OqH4TR","colab":{"base_uri":"https://localhost:8080/"},"outputId":"b3e30156-891e-4e5b-e048-4bfa6881f4bd","execution":{"iopub.status.busy":"2023-06-25T11:14:58.812208Z","iopub.execute_input":"2023-06-25T11:14:58.812553Z","iopub.status.idle":"2023-06-25T11:14:58.831023Z","shell.execute_reply.started":"2023-06-25T11:14:58.812518Z","shell.execute_reply":"2023-06-25T11:14:58.829981Z"},"trusted":true},"execution_count":20,"outputs":[{"name":"stdout","text":"MICRO AVERAGE: precision: 0.8398547801532876, recall: 0.8398547801532876, f1score: 0.8398547801532876\nMACRO AVERAGE: precision: 0.4395355461826938, recall: 0.3985151778365969, f1score: 0.37827742997740393\n","output_type":"stream"},{"name":"stderr","text":"/opt/conda/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1344: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n  _warn_prf(average, modifier, msg_start, len(result))\n","output_type":"stream"}]},{"cell_type":"code","source":"from sklearn.metrics import precision_recall_fscore_support, accuracy_score, confusion_matrix, ConfusionMatrixDisplay\n\ncm = confusion_matrix(labels_true, labels_pred, labels=[0,1,2,3,4])\ndisp = ConfusionMatrixDisplay(confusion_matrix=cm,\n                              display_labels=[0,1,2,3,4])\ndisp.plot()\nplt.show()\n","metadata":{"id":"Cav6vrfMleX0","execution":{"iopub.status.busy":"2023-06-25T11:14:58.834343Z","iopub.execute_input":"2023-06-25T11:14:58.835064Z","iopub.status.idle":"2023-06-25T11:14:59.193603Z","shell.execute_reply.started":"2023-06-25T11:14:58.835030Z","shell.execute_reply":"2023-06-25T11:14:59.192683Z"},"trusted":true},"execution_count":21,"outputs":[{"output_type":"display_data","data":{"text/plain":"<Figure size 640x480 with 2 Axes>","image/png":"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"},"metadata":{}}]},{"cell_type":"markdown","source":"# BEST GPT","metadata":{}},{"cell_type":"code","source":"import torch\nimport torch.nn as nn\nfrom transformers import GPT2Model, GPT2Tokenizer, GPT2Config, GPT2ForSequenceClassification\n\n\nclass GPTClassifier(nn.Module):\n    def __init__(self, model_path, tokenizer_path, n_classes=5, max_len=512):\n        super(GPTClassifier, self).__init__()\n        self.max_len = max_len\n        self.gpt_config = GPT2Config.from_pretrained(model_path, num_labels=n_classes)\n        self.gpt_model = GPT2Model.from_pretrained(model_path, config=self.gpt_config)\n        self.tokenizer = GPT2Tokenizer.from_pretrained(tokenizer_path)\n        self.tokenizer.padding_side = \"left\"\n        if self.tokenizer.pad_token is None:\n            self.tokenizer.add_special_tokens({'pad_token': '[PAD]'})\n        self.gpt_model.resize_token_embeddings(len(self.tokenizer))\n        self.clf = nn.Linear(self.gpt_config.hidden_size, n_classes)\n\n\n    def forward(self, input_ids, attention_mask):\n        outputs = self.gpt_model(input_ids, attention_mask=attention_mask)\n        hidden_state = outputs.last_hidden_state\n        pooled_output = hidden_state[:, 0]\n        logits = self.clf(pooled_output)\n        return logits","metadata":{"execution":{"iopub.status.busy":"2023-06-25T11:14:59.194932Z","iopub.execute_input":"2023-06-25T11:14:59.195525Z","iopub.status.idle":"2023-06-25T11:14:59.249248Z","shell.execute_reply.started":"2023-06-25T11:14:59.195491Z","shell.execute_reply":"2023-06-25T11:14:59.248302Z"},"trusted":true},"execution_count":22,"outputs":[]},{"cell_type":"code","source":"class Trainer:\n    def __init__(self, model, epochs=1, batch_size=16, model_save_path='/content/bert.pt'):\n        self.device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n        self.model = model.to(self.device)\n        self.tokenizer = self.model.tokenizer\n        self.max_len = self.model.max_len\n        self.epochs = epochs\n        self.batch_size = batch_size\n        self.model_save_path = model_save_path\n\n    def preparation(self, X_train, y_train, X_valid, y_valid):\n        data = pd.concat([pd.Series(X_train), pd.Series(y_train)], axis=1, ignore_index=True).rename(columns={0: 'review', 1: 'rating_value'})\n        # create datasets\n        self.train_set = CustomDataset(X_train, y_train, self.tokenizer)\n        self.valid_set = CustomDataset(X_valid, y_valid, self.tokenizer)\n\n        # create data loaders\n        self.train_loader = DataLoader(self.train_set, batch_size=self.batch_size, shuffle=True)\n        self.valid_loader = DataLoader(self.valid_set, batch_size=self.batch_size, shuffle=True)\n\n        # helpers initialization\n        self.optimizer = AdamW(self.model.parameters(), lr=2e-5, correct_bias=False)\n        self.scheduler = get_linear_schedule_with_warmup(\n                self.optimizer,\n                num_warmup_steps=0,\n                num_training_steps=len(self.train_loader) * self.epochs\n            )\n        # c учетом дисбаланса\n        weights = torch.tensor(list(data.groupby('rating_value').count().review.max() / data.groupby('rating_value').count().review))\n        self.loss_fn = torch.nn.CrossEntropyLoss(weight=weights).to(self.device)\n        # без учета дисбаланса\n#         self.loss_fn = torch.nn.CrossEntropyLoss().to(self.device)\n\n    def fit(self):\n        self.model = self.model.train()\n        losses = []\n        f1_micro_scores = []\n        f1_macro_scores = []\n        accuracy_scores = []\n        correct_predictions = 0\n\n        for step, data in enumerate(tqdm(self.train_loader)):\n            input_ids = data[\"input_ids\"].to(self.device)\n            attention_mask = data[\"attention_mask\"].to(self.device)\n            targets = data[\"targets\"].to(self.device)\n            # print(input_ids.shape, targets.shape)\n            outputs = self.model(\n                input_ids=input_ids,\n                attention_mask=attention_mask\n                )\n            preds = torch.argmax(outputs, dim=1)\n\n            loss = self.loss_fn(outputs, targets)\n\n            correct_predictions += torch.sum(preds == targets)\n            acc = torch.sum(preds == targets) / len(targets)\n            f1_micro = multiclass_f1_score(preds, targets, num_classes=5, average='micro')\n            f1_macro = multiclass_f1_score(preds, targets, num_classes=5, average='macro')\n\n            losses.append(loss.item())\n            f1_micro_scores.append(f1_micro)\n            f1_macro_scores.append(f1_macro)\n            accuracy_scores.append(acc)\n\n            if step % 10 == 0:\n              wandb.log({\n                  'loss': torch.mean(torch.tensor(losses[-10:], dtype=torch.float32)),\n                  'accuracy': torch.mean(torch.tensor(accuracy_scores[-10:], dtype=torch.float32)),\n                  'f1_micro': torch.mean(torch.tensor(f1_micro_scores[-10:], dtype=torch.float32)),\n                  'f1_macro': torch.mean(torch.tensor(f1_macro_scores[-10:], dtype=torch.float32))\n                  })\n\n            loss.backward()\n            torch.nn.utils.clip_grad_norm_(self.model.parameters(), max_norm=1.0)\n            self.optimizer.step()\n            self.scheduler.step()\n            self.optimizer.zero_grad()\n\n\n        train_acc = correct_predictions.double() / len(self.train_set)\n        train_loss = torch.mean(torch.tensor(losses, dtype=torch.float32))\n        return train_acc, train_loss\n\n    def eval(self):\n        self.model = self.model.eval()\n        losses = []\n        correct_predictions = 0\n\n        with torch.no_grad():\n            for data in tqdm(self.valid_loader):\n                input_ids = data[\"input_ids\"].to(self.device)\n                attention_mask = data[\"attention_mask\"].to(self.device)\n                targets = data[\"targets\"].to(self.device)\n\n                outputs = self.model(\n                    input_ids=input_ids,\n                    attention_mask=attention_mask\n                    )\n\n                preds = torch.argmax(outputs, dim=1)\n                loss = self.loss_fn(outputs, targets)\n                correct_predictions += torch.sum(preds == targets)\n                losses.append(loss.item())\n\n        val_acc = correct_predictions.double() / len(self.valid_set)\n        val_loss = np.mean(losses)\n        return val_acc, val_loss\n\n    def train(self):\n        best_accuracy = 0\n        for epoch in tqdm(range(self.epochs)):\n            # print(f'Epoch {epoch + 1}/{self.epochs}')\n            train_acc, train_loss = self.fit()\n            wandb.log({'train_acc': train_acc})\n            # print(f'Train loss {train_loss} accuracy {train_acc}')\n\n            val_acc, val_loss = self.eval()\n            wandb.log({'val_acc': val_acc})\n            # print(f'Val loss {val_loss} accuracy {val_acc}')\n            # print('-' * 10)\n\n            if val_acc > best_accuracy:\n                torch.save({\n                    'epoch': epoch,\n                    'model_state_dict': self.model.state_dict(),\n                    'optimizer_state_dict': self.optimizer.state_dict(),\n                    'loss': val_loss,\n                    'accuracy': val_acc,\n                    }, self.model_save_path)\n                best_accuracy = val_acc\n\n        state = torch.load(self.model_save_path)\n        self.model.load_state_dict(state['model_state_dict'])\n        data = pd.DataFrame(config, index=[0])\n        data['accuracy'], data['loss'] =  state['accuracy'], state['loss']\n        table = wandb.Table(data=data)\n        wandb.log({'config': table})\n\n        wandb.finish()\n\n    def predict(self, text):\n        encoding = self.tokenizer.encode_plus(\n            text,\n            add_special_tokens=True,\n            max_length=self.max_len,\n            return_token_type_ids=False,\n            truncation=True,\n            padding='max_length',\n            return_attention_mask=True,\n            return_tensors='pt',\n        )\n\n        out = {\n              'text': text,\n              'input_ids': encoding['input_ids'].flatten(),\n              'attention_mask': encoding['attention_mask'].flatten()\n          }\n\n        input_ids = out[\"input_ids\"].to(self.device)\n        attention_mask = out[\"attention_mask\"].to(self.device)\n\n        outputs = self.model(\n            input_ids=input_ids.unsqueeze(0),\n            attention_mask=attention_mask.unsqueeze(0)\n        )\n        prediction = outputs.cpu().detach()\n\n        return prediction","metadata":{"execution":{"iopub.status.busy":"2023-06-25T11:14:59.250604Z","iopub.execute_input":"2023-06-25T11:14:59.251403Z","iopub.status.idle":"2023-06-25T11:14:59.283163Z","shell.execute_reply.started":"2023-06-25T11:14:59.251370Z","shell.execute_reply":"2023-06-25T11:14:59.282206Z"},"trusted":true},"execution_count":23,"outputs":[]},{"cell_type":"code","source":"import wandb\nwandb.login()\n\n# ai-forever/rugpt3small_based_on_gpt2\nconfig={\n      \"learning_rate\": 2e-5,\n      \"architecture\": \"ai-forever/rugpt3small_based_on_gpt2\",\n      \"weight_balance\": True,\n      \"dataset\": \"Bank_review_dataset\",\n      \"epochs\": 3,\n      \"batch_size\": 8,\n}\n\nwandb.init(\n    # Set the project where this run will be logged\n    project=\"course_work\",\n    # We pass a run name (otherwise it’ll be randomly assigned, like sunshine-lollypop-10)\n    name=f\"GPT3 BEST\",\n    # Track hyperparameters and run metadata\n    config=config)","metadata":{"execution":{"iopub.status.busy":"2023-06-25T11:14:59.284628Z","iopub.execute_input":"2023-06-25T11:14:59.284985Z","iopub.status.idle":"2023-06-25T11:15:30.141629Z","shell.execute_reply.started":"2023-06-25T11:14:59.284952Z","shell.execute_reply":"2023-06-25T11:15:30.140818Z"},"trusted":true},"execution_count":24,"outputs":[{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Tracking run with wandb version 0.15.4"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Run data is saved locally in <code>/kaggle/working/wandb/run-20230625_111459-lq42uq19</code>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Syncing run <strong><a href='https://wandb.ai/romjiik/course_work/runs/lq42uq19' target=\"_blank\">GPT3 BEST</a></strong> to <a href='https://wandb.ai/romjiik/course_work' target=\"_blank\">Weights & Biases</a> (<a href='https://wandb.me/run' target=\"_blank\">docs</a>)<br/>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":" View project at <a href='https://wandb.ai/romjiik/course_work' target=\"_blank\">https://wandb.ai/romjiik/course_work</a>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":" View run at <a href='https://wandb.ai/romjiik/course_work/runs/lq42uq19' target=\"_blank\">https://wandb.ai/romjiik/course_work/runs/lq42uq19</a>"},"metadata":{}},{"execution_count":24,"output_type":"execute_result","data":{"text/html":"<button onClick=\"this.nextSibling.style.display='block';this.style.display='none';\">Display W&B run</button><iframe src='https://wandb.ai/romjiik/course_work/runs/lq42uq19?jupyter=true' style='border:none;width:100%;height:420px;display:none;'></iframe>","text/plain":"<wandb.sdk.wandb_run.Run at 0x7d4ffa713d00>"},"metadata":{}}]},{"cell_type":"code","source":"seed_everything(42)\n\nclassifier = GPTClassifier(\n        model_path='ai-forever/rugpt3small_based_on_gpt2',\n        tokenizer_path='ai-forever/rugpt3small_based_on_gpt2'\n)\n\ntrainer = Trainer(\n        model=classifier,\n        epochs=config['epochs'],\n        batch_size=config['batch_size'],\n#         model_save_path='/content/drive/MyDrive/Colab Notebooks/course_work/models/gpt3_e1_b16.pt'\n        model_save_path = '/kaggle/working/gpt3_e3_b8_best.pt'\n)","metadata":{"execution":{"iopub.status.busy":"2023-06-25T11:15:30.145481Z","iopub.execute_input":"2023-06-25T11:15:30.147966Z","iopub.status.idle":"2023-06-25T11:15:57.762378Z","shell.execute_reply.started":"2023-06-25T11:15:30.147931Z","shell.execute_reply":"2023-06-25T11:15:57.761283Z"},"trusted":true},"execution_count":25,"outputs":[{"output_type":"display_data","data":{"text/plain":"Downloading (…)lve/main/config.json:   0%|          | 0.00/608 [00:00<?, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"7a0ea17fd9fb4b7a8c8d3a57d6b709ec"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"Downloading pytorch_model.bin:   0%|          | 0.00/551M [00:00<?, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"20c21c81beda4a59995899889539950b"}},"metadata":{}},{"name":"stderr","text":"Some weights of the model checkpoint at ai-forever/rugpt3small_based_on_gpt2 were not used when initializing GPT2Model: ['lm_head.weight']\n- This IS expected if you are initializing GPT2Model from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n- This IS NOT expected if you are initializing GPT2Model from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n","output_type":"stream"},{"output_type":"display_data","data":{"text/plain":"Downloading (…)olve/main/vocab.json: 0.00B [00:00, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"62423518a0a3426e8ca7e081ab033337"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"Downloading (…)olve/main/merges.txt: 0.00B [00:00, ?B/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"e58533b2845b40dba453fe04034903ad"}},"metadata":{}},{"name":"stderr","text":"Using pad_token, but it is not set yet.\n","output_type":"stream"}]},{"cell_type":"code","source":"trainer.preparation(\n        X_train=list(train_data['review']),\n        y_train=list(train_data['rating_value']),\n        X_valid=list(test_data['review']),\n        y_valid=list(test_data['rating_value'])\n    )","metadata":{"execution":{"iopub.status.busy":"2023-06-25T11:15:57.765971Z","iopub.execute_input":"2023-06-25T11:15:57.766812Z","iopub.status.idle":"2023-06-25T11:15:57.814753Z","shell.execute_reply.started":"2023-06-25T11:15:57.766753Z","shell.execute_reply":"2023-06-25T11:15:57.813692Z"},"trusted":true},"execution_count":26,"outputs":[{"name":"stderr","text":"/opt/conda/lib/python3.10/site-packages/transformers/optimization.py:411: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning\n  warnings.warn(\n","output_type":"stream"}]},{"cell_type":"code","source":"%%time\ntrainer.train()","metadata":{"execution":{"iopub.status.busy":"2023-06-25T11:15:57.819484Z","iopub.execute_input":"2023-06-25T11:15:57.822168Z","iopub.status.idle":"2023-06-25T12:14:25.567051Z","shell.execute_reply.started":"2023-06-25T11:15:57.822125Z","shell.execute_reply":"2023-06-25T12:14:25.566057Z"},"trusted":true},"execution_count":27,"outputs":[{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/3 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"25efd273e722472aaa800b707b2541be"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/1240 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"2a2ec4876ffd4441938a434f71c6b9cd"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/310 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"4d9df0808f3d440394b7a608bac06d92"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/1240 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"2b08d01db5b74732a5616740e391d10a"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/310 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"5debc1eabd8548b6801ecd5a73b18894"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/1240 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"6e377bada09c41a482e5bfe61f760f5d"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"  0%|          | 0/310 [00:00<?, ?it/s]","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"f6cdd0416df548d08c8d087626bb3116"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Waiting for W&B process to finish... <strong style=\"color:green\">(success).</strong>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"VBox(children=(Label(value='0.003 MB of 0.003 MB uploaded (0.000 MB deduped)\\r'), FloatProgress(value=1.0, max…","application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"093b1ff1394a44e48c6c5a1605bd6b81"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"<style>\n    table.wandb td:nth-child(1) { padding: 0 10px; text-align: left ; width: auto;} td:nth-child(2) {text-align: left ; width: 100%}\n    .wandb-row { display: flex; flex-direction: row; flex-wrap: wrap; justify-content: flex-start; width: 100% }\n    .wandb-col { display: flex; flex-direction: column; flex-basis: 100%; flex: 1; padding: 10px; }\n    </style>\n<div class=\"wandb-row\"><div class=\"wandb-col\"><h3>Run history:</h3><br/><table class=\"wandb\"><tr><td>accuracy</td><td>▁▇▇▆▆▆▆▃▆▇▅▇▇█▇▇▆▇▇▇▇▇▇▇▇▇▆▇▇▇▆█▇▇███▇██</td></tr><tr><td>f1_macro</td><td>▁▆▆▆▅▆▅▃▅▇▄▆▇▇▆▇▆▆▇▇▆▆▇▇▆▇▅▆▆▆▆█▆▆▇▇▇▆█▇</td></tr><tr><td>f1_micro</td><td>▁▇▇▆▆▆▆▃▆▇▅▇▇█▇▇▆▇▇▇▇▇▇▇▇▇▆▇▇▇▆█▇▇███▇██</td></tr><tr><td>loss</td><td>█▆▆▅▆▅▅▆▆▄▅▄▇▃▃▆▃▃▄▂▅█▃▄▃▄▇▅▃▃▄▁▄▃▂▁▃▆▃▂</td></tr><tr><td>train_acc</td><td>▁██</td></tr><tr><td>val_acc</td><td>█▁▇</td></tr></table><br/></div><div class=\"wandb-col\"><h3>Run summary:</h3><br/><table class=\"wandb\"><tr><td>accuracy</td><td>0.8875</td></tr><tr><td>f1_macro</td><td>0.6972</td></tr><tr><td>f1_micro</td><td>0.8875</td></tr><tr><td>loss</td><td>0.72676</td></tr><tr><td>train_acc</td><td>0.80087</td></tr><tr><td>val_acc</td><td>0.80113</td></tr></table><br/></div></div>"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":" View run <strong style=\"color:#cdcd00\">GPT3 BEST</strong> at: <a href='https://wandb.ai/romjiik/course_work/runs/lq42uq19' target=\"_blank\">https://wandb.ai/romjiik/course_work/runs/lq42uq19</a><br/>Synced 6 W&B file(s), 1 media file(s), 1 artifact file(s) and 0 other file(s)"},"metadata":{}},{"output_type":"display_data","data":{"text/plain":"<IPython.core.display.HTML object>","text/html":"Find logs at: <code>./wandb/run-20230625_111459-lq42uq19/logs</code>"},"metadata":{}},{"name":"stdout","text":"CPU times: user 57min 55s, sys: 16.8 s, total: 58min 11s\nWall time: 58min 27s\n","output_type":"stream"}]},{"cell_type":"code","source":"texts = list(valid['review'])\npredictions = [trainer.predict(t) for t in texts]\n","metadata":{"execution":{"iopub.status.busy":"2023-06-25T12:14:25.568373Z","iopub.execute_input":"2023-06-25T12:14:25.568757Z","iopub.status.idle":"2023-06-25T12:15:44.619420Z","shell.execute_reply.started":"2023-06-25T12:14:25.568706Z","shell.execute_reply":"2023-06-25T12:15:44.618464Z"},"trusted":true},"execution_count":28,"outputs":[]},{"cell_type":"code","source":"labels_true = valid['rating_value']\nlabels_pred = torch.argmax(nn.functional.softmax(torch.cat(predictions,dim=0), dim=1), dim=1)","metadata":{"execution":{"iopub.status.busy":"2023-06-25T12:15:44.621911Z","iopub.execute_input":"2023-06-25T12:15:44.622291Z","iopub.status.idle":"2023-06-25T12:15:44.628508Z","shell.execute_reply.started":"2023-06-25T12:15:44.622256Z","shell.execute_reply":"2023-06-25T12:15:44.627231Z"},"trusted":true},"execution_count":29,"outputs":[]},{"cell_type":"code","source":"rom sklearn.metrics import precision_recall_fscore_support, accuracy_score\n\nprecision, recall, f1score = precision_recall_fscore_support(labels_true, labels_pred,average='micro')[:3]\n\nprint(f'MICRO AVERAGE: precision: {precision}, recall: {recall}, f1score: {f1score}')\n\nprecision, recall, f1score = precision_recall_fscore_support(labels_true, labels_pred,average='macro')[:3]\n\nprint(f'MACRO AVERAGE: precision: {precision}, recall: {recall}, f1score: {f1score}')","metadata":{"execution":{"iopub.status.busy":"2023-06-25T12:15:44.630115Z","iopub.execute_input":"2023-06-25T12:15:44.630514Z","iopub.status.idle":"2023-06-25T12:15:44.643341Z","shell.execute_reply.started":"2023-06-25T12:15:44.630481Z","shell.execute_reply":"2023-06-25T12:15:44.642203Z"},"trusted":true},"execution_count":30,"outputs":[{"traceback":["\u001b[0;36m  Cell \u001b[0;32mIn[30], line 1\u001b[0;36m\u001b[0m\n\u001b[0;31m    rom sklearn.metrics import precision_recall_fscore_support, accuracy_score\u001b[0m\n\u001b[0m        ^\u001b[0m\n\u001b[0;31mSyntaxError\u001b[0m\u001b[0;31m:\u001b[0m invalid syntax\n"],"ename":"SyntaxError","evalue":"invalid syntax (476421122.py, line 1)","output_type":"error"}]},{"cell_type":"code","source":"from sklearn.metrics import precision_recall_fscore_support, accuracy_score, confusion_matrix, ConfusionMatrixDisplay\n\ncm = confusion_matrix(labels_true, labels_pred, labels=[0,1,2,3,4])\ndisp = ConfusionMatrixDisplay(confusion_matrix=cm,\n                              display_labels=[0,1,2,3,4])\ndisp.plot()\nplt.show()","metadata":{"execution":{"iopub.status.busy":"2023-06-25T12:15:44.644609Z","iopub.status.idle":"2023-06-25T12:15:44.645392Z","shell.execute_reply.started":"2023-06-25T12:15:44.645089Z","shell.execute_reply":"2023-06-25T12:15:44.645113Z"},"trusted":true},"execution_count":null,"outputs":[]},{"cell_type":"code","source":"","metadata":{},"execution_count":null,"outputs":[]}]}